import{r as h,j as e,H as I,B as y,a2 as B,P as v,T as C,a4 as R,a3 as p,av as q,a5 as G,aE as H,aF as O,aG as U,aH as Q,p as V,q as J,y as A,e as K,aa as x,M as W,F as X,Q as Y,s as Z}from"./index-CMJNtPD3.js";import{I as $,l as k}from"./lodash-C7AKTjaF.js";import{T as s,C as ee,I as te,A as se}from"./AdminProtectedBodyLayout-BNX7hyK0.js";import{A as ie}from"./ActionIcon-DUWXgDlG.js";import{I as re,a as ae}from"./IconChevronUp-D8c7NHdB.js";import{T as j,I as ne}from"./IconJoinRound-D7UBqywU.js";const oe="_th_1w9xk_1",ce="_control_1w9xk_5",le="_icon_1w9xk_17",g={th:oe,control:ce,icon:le};function f({children:o,reversed:a,sorted:d,onSort:n,...u}){const i=d?a?re:ae:te;return e.jsx(s.Th,{...u,className:g.th,children:e.jsx(R,{onClick:n,className:g.control,children:e.jsxs(I,{justify:"space-between",children:[e.jsx(C,{fw:500,fz:"sm",children:o}),n?e.jsx(ee,{className:g.icon,children:e.jsx(i,{style:{width:p(16),height:p(16)},stroke:1.5})}):e.jsx(e.Fragment,{})]})})})}function de({data:o,onDelete:a,onEdit:d}){const[n,u]=h.useState(o),i=n==null?void 0:n.map(c=>e.jsxs(s.Tr,{children:[e.jsx(s.Td,{children:c.criteriaName}),e.jsx(s.Td,{children:c.description}),e.jsx(s.Td,{children:e.jsxs(I,{children:[e.jsx(y,{variant:"light",size:"xs",onClick:()=>d(c),children:"Edit"}),e.jsx(ie,{variant:"light",color:"red",onClick:()=>a(c),children:e.jsx($,{})})]})})]},c.id));return h.useEffect(()=>{u(o)},[o]),e.jsx(B,{children:e.jsx(v,{children:e.jsxs(s,{horizontalSpacing:"md",verticalSpacing:"xs",layout:"fixed",children:[e.jsx(s.Tbody,{children:e.jsxs(s.Tr,{children:[e.jsx(f,{children:"Name"}),e.jsx(f,{children:"Description"}),e.jsx(f,{style:{width:200},children:"Action"})]})}),e.jsx(s.Tbody,{children:i!=null&&i.length?i:e.jsx(s.Tr,{children:e.jsx(s.Td,{colSpan:3,children:e.jsx(C,{fw:500,ta:"center",children:"Nothing found"})})})})]})})})}const ge=()=>{var w;const o={width:p(12),height:p(12)},[a,d]=q();h.useEffect(()=>{d({tab:(a==null?void 0:a.get("tab"))??"projects"})},[]);const[n,u]=h.useState([]),{semesterId:i}=G(),{data:c,isLoading:E,refetch:b}=H(i,{skip:!i,refetchOnMountOrArgChange:!0}),[N,{isLoading:D}]=O(),[L,{isLoading:_}]=U(),[z,{isLoading:P}]=Q(),[F,{open:S,close:T}]=V(!1),r=J({mode:"controlled",initialValues:{id:null,criteriaName:"",description:""}}),M=async t=>{var m;try{t!=null&&t.id?(await N({body:k.omit(t,"id"),id:t.id.toString()}).unwrap(),x.show({title:"Success",message:"Criteria updated successfully",color:"green"})):(await z({id:i,body:k.omit(t,"id")}).unwrap(),x.show({title:"Success",message:"Criteria added successfully",color:"green"})),b()}catch(l){x.show({title:"Error",message:((m=l==null?void 0:l.data)==null?void 0:m.message)??"",color:"red"})}finally{r.reset(),T()}};return e.jsxs(se,{title:"Criteria",loadingOverlay:E,action:{label:"Add criteria",onClick:()=>{r.reset(),S()}},children:[e.jsxs(j,{value:a.get("tab")||"projects",onChange:t=>{d({tab:t})},children:[e.jsx(j.List,{bg:"white",mb:"sm",children:e.jsx(j.Tab,{value:"projects",leftSection:e.jsx(ne,{style:o}),children:"Current criteria"})}),e.jsx(j.Panel,{value:"projects",children:e.jsx(de,{data:c??[],selection:n,setSelection:u,onHandleAllocate:()=>{},onEdit:t=>{r.setValues(t),S()},onDelete:t=>{A.open({size:"sm",title:"Delete judge",children:e.jsxs(e.Fragment,{children:[e.jsxs(C,{size:"sm",children:["Are you sure you want to delete criteria"," ",e.jsx("b",{children:t.criteriaName}),"?"]}),e.jsx(K,{ta:"end",mt:"lg",children:e.jsx(y,{ta:"center",loading:_,color:"red",onClick:async()=>{var m;try{await L({id:t.id.toString()}).unwrap(),x.show({title:"Success",message:"Criteria deleted successfully",color:"red"}),b()}catch(l){x.show({title:"Error",message:((m=l==null?void 0:l.data)==null?void 0:m.message)??"",color:"red"})}finally{A.closeAll()}},children:"Delete"})})]})})}})})]}),e.jsx(W,{opened:F,onClose:T,title:(w=r.values)!=null&&w.id?"Edit criteria":"Add criteria",size:"lg",children:e.jsx("form",{onSubmit:r.onSubmit(M),children:e.jsxs(X,{direction:"column",gap:"sm",children:[h.createElement(Y,{...r.getInputProps("criteriaName"),label:"Criteria Name",withAsterisk:!0,key:r.key("criteriaName"),required:!0}),h.createElement(Z,{...r.getInputProps("description"),label:"Description",withAsterisk:!0,key:r.key("description"),required:!0}),e.jsx(y,{type:"submit",size:"md",mt:"md",loading:P||D,children:"Submit"})]})})})]})};export{ge as default};
