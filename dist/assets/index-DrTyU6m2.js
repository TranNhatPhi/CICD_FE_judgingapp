import{b as Be,j as t,d as ae,e as X,f as Ne,g as Ge,h as Oe,i as ne,r as C,k as De,l as Ve,m as Le,n as Te,o as Ee,p as Ae,q as Je,O as Ue,F as f,T as c,B as O,D as re,s as qe,V as Qe,M as We,P as ce,t as Xe,v as Ke,w as Ye,a as Ze,x as He,y as se}from"./index-DLdgdxs1.js";import{G as pe}from"./index-BaVe-YJU.js";import{C as I}from"./Card-CtQc0EFa.js";import{G as F,a as Q}from"./Grid-xB-elmy6.js";import{z as b}from"./index-DXqQCM1T.js";import"./IconChevronUp-B8fDyk06.js";function et(e,i,r){return i===void 0&&r===void 0?e:i!==void 0&&r===void 0?Math.max(e,i):Math.min(i===void 0&&r!==void 0?e:Math.max(e,i),r)}const[tt,le]=Be("Rating was not found in tree");function de(e){const{width:i,height:r,style:d,...l}=e;return t.jsx("svg",{viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{width:i,height:r,...d},...l,children:t.jsx("path",{d:"M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z"})})}de.displayName="@mantine/core/StarIcon";function K({type:e}){const i=le();return t.jsx(de,{...i.getStyles("starSymbol"),"data-filled":e==="full"||void 0})}K.displayName="@mantine/core/StarSymbol";function oe({getSymbolLabel:e,emptyIcon:i,fullIcon:r,full:d,active:l,value:o,readOnly:u,fractionValue:w,color:z,id:h,onBlur:m,onChange:x,onInputChange:S,style:n,...k}){var y;const a=le(),R=typeof r=="function"?r(o):r,j=typeof i=="function"?i(o):i,{dir:M}=ae();return t.jsxs(t.Fragment,{children:[!u&&t.jsx("input",{...a.getStyles("input"),onKeyDown:$=>$.key===" "&&x(o),id:h,type:"radio","data-active":l||void 0,"aria-label":e==null?void 0:e(o),value:o,onBlur:m,onChange:S,...k}),t.jsx(X,{component:u?"div":"label",...a.getStyles("label"),"data-read-only":u||void 0,htmlFor:h,onClick:()=>x(o),__vars:{"--rating-item-z-index":(y=w===1?void 0:l?2:0)==null?void 0:y.toString()},children:t.jsx(X,{...a.getStyles("symbolBody"),__vars:{"--rating-symbol-clip-path":w===1?void 0:M==="ltr"?`inset(0 ${l?100-w*100:100}% 0 0)`:`inset(0 0 0 ${l?100-w*100:100}% )`},children:d?R||t.jsx(K,{type:"full"}):j||t.jsx(K,{type:"empty"})})})]})}oe.displayName="@mantine/core/RatingItem";var ue={root:"m_f8d312f2",symbolGroup:"m_61734bb7",starSymbol:"m_5662a89a",input:"m_211007ba",label:"m_21342ee4",symbolBody:"m_fae05d6a"};function W(e,i){var l;const r=Math.round(e/i)*i,d=((l=`${i}`.split(".")[1])==null?void 0:l.length)||0;return Number(r.toFixed(d))}const it={size:"sm",getSymbolLabel:e=>`${e}`,count:5,fractions:1,color:"yellow"},nt=Le((e,{size:i,color:r})=>({root:{"--rating-size":Te(i,"rating-size"),"--rating-color":Ee(r,e)}})),Y=Ne((e,i)=>{const r=Ge("Rating",it,e),{classNames:d,className:l,style:o,styles:u,unstyled:w,vars:z,name:h,id:m,value:x,defaultValue:S,onChange:n,fractions:k,count:a,onMouseEnter:R,readOnly:j,onMouseMove:M,onHover:y,onMouseLeave:$,onTouchStart:D,onTouchEnd:V,size:me,variant:he,getSymbolLabel:je,color:lt,emptySymbol:ge,fullSymbol:fe,highlightSelectedOnly:xe,...ye}=r,L=Oe({name:"Rating",classes:ue,props:r,className:l,style:o,classNames:d,styles:u,unstyled:w,vars:z,varsResolver:nt}),{dir:be}=ae(),we=ne(h),Z=ne(m),H=C.useRef(null),[ke,T]=De({value:x,defaultValue:S,finalValue:0,onChange:n}),[B,N]=C.useState(-1),[Se,p]=C.useState(!0),E=Math.floor(k),A=Math.floor(a),_=1/E,ee=W(ke,_),J=B!==-1?B:ee,te=s=>{const{left:g,right:v,width:U}=H.current.getBoundingClientRect(),q=U/A,G=(be==="rtl"?v-s:s-g)/q;return et(W(G+_/2,_),_,A)},Me=s=>{R==null||R(s),!j&&p(!1)},ve=s=>{if(M==null||M(s),j)return;const g=te(s.clientX);N(g),g!==B&&(y==null||y(g))},Ce=s=>{$==null||$(s),!j&&(N(-1),p(!0),B!==-1&&(y==null||y(-1)))},ze=s=>{const{touches:g}=s;if(g.length===1){if(!j){const v=g[0];T(te(v.clientX))}D==null||D(s)}},Re=s=>{s.preventDefault(),V==null||V(s)},Ie=()=>Se&&N(-1),_e=s=>{j||N(typeof s=="number"?s:parseFloat(s.target.value))},Pe=s=>{j||T(typeof s=="number"?s:parseFloat(s.target.value))},Fe=Array(A).fill(0).map((s,g)=>{const v=g+1,U=Array.from(new Array(g===0?E+1:E)),q=!j&&Math.ceil(B)===v;return t.jsx("div",{"data-active":q||void 0,...L("symbolGroup"),children:U.map(($e,G)=>{const ie=_*(g===0?G:G+1),P=W(v-1+ie,_);return t.jsx(oe,{getSymbolLabel:je,emptyIcon:ge,fullIcon:fe,full:xe?P===J:P<=J,active:P===J,checked:P===ee,readOnly:j,fractionValue:ie,value:P,name:we,onChange:Pe,onBlur:Ie,onInputChange:_e,id:`${Z}-${g}-${G}`},`${v}-${P}`)})},v)});return t.jsx(tt,{value:{getStyles:L},children:t.jsx(X,{ref:Ve(H,i),...L("root"),onMouseMove:ve,onMouseEnter:Me,onMouseLeave:Ce,onTouchStart:ze,onTouchEnd:Re,variant:he,size:me,id:Z,...ye,children:Fe})})});Y.classes=ue;Y.displayName="@mantine/core/Rating";const rt=e=>{var z;const[i,r]=C.useState(e.isMarked),[d,{open:l,close:o}]=Ae(!1),u=Je({mode:"controlled",initialValues:{...e.criteria,comment:e==null?void 0:e.comment}}),w=h=>{const{comment:m,criteria:x}=h,S=Object.values(x).reduce((n,k,a)=>{var j,M,y;console.log("props?.criteriaList?.[index]",(j=e==null?void 0:e.criteriaList)==null?void 0:j[a]);const R=((y=(M=e==null?void 0:e.criteriaList)==null?void 0:M[a])==null?void 0:y.id)??0;return n[R]=k+4,n},{});e==null||e.onMark({mark:S,projectId:e==null?void 0:e.id,comment:m}),r(!0)};return C.useEffect(()=>{r(e.isMarked)},[e.isMarked]),C.useEffect(()=>{u.isDirty("criteria")||u.setValues({...e.criteria,comment:e==null?void 0:e.comment})},[e==null?void 0:e.criteria]),t.jsxs("form",{onSubmit:u.onSubmit(w),children:[t.jsxs(I,{radius:"lg",padding:"lg",pos:"relative",children:[(e==null?void 0:e.disabled)&&t.jsx(Ue,{opacity:.95}),t.jsx(I.Section,{inheritPadding:!0,withBorder:!0,py:"sm",children:t.jsxs(f,{justify:"space-between",align:"center",gap:"sm",children:[t.jsxs(f,{direction:"column",children:[t.jsxs(f,{justify:"space-between",gap:"sm",children:[t.jsx(c,{size:"md",w:60,children:"Name"}),t.jsx(c,{c:"orange.8",flex:1,children:e==null?void 0:e.title})]}),t.jsxs(f,{justify:"space-between",gap:"sm",children:[t.jsx(c,{size:"md",w:60,children:"Project"}),t.jsx(c,{c:"orange.8",flex:1,children:e==null?void 0:e.project})]})]}),t.jsx(O,{size:"md",variant:"light",miw:100,onClick:l,children:"Detail"})]})}),t.jsx(I.Section,{inheritPadding:!0,py:"sm",children:t.jsxs(F,{gutter:"md",children:[t.jsx(F.Col,{span:12,children:t.jsx(c,{size:"md",fw:700,children:"Project Evaluation"})}),i?t.jsxs(t.Fragment,{children:[t.jsx(F.Col,{span:12,children:t.jsxs(f,{justify:"space-between",align:"center",children:[t.jsx(c,{size:"sm",fw:600,c:"blue.9",children:"Criterion"}),t.jsx(c,{size:"sm",fw:600,c:"blue.9",children:"Grade"})]})}),t.jsx(F.Col,{span:12,children:t.jsx(re,{})})]}):t.jsx(t.Fragment,{}),(z=e==null?void 0:e.criteriaList)==null?void 0:z.map((h,m)=>t.jsxs(F.Col,{span:12,children:[t.jsxs(f,{mb:"xs",direction:i?"row":"column",justify:i?"space-between":"-moz-initial",children:[t.jsxs(c,{size:"sm",c:"blue.7",children:[m+1,". ",h.criteriaName]}),i?t.jsx(c,{size:"md",fw:700,c:"blue.7",children:e.criteria.criteria[`criteria${m+1}`]+4}):t.jsx(t.Fragment,{})]}),i?t.jsx(t.Fragment,{}):t.jsx(Y,{count:6,highlightSelectedOnly:!0,emptySymbol:st,fullSymbol:at,...u.getInputProps(`criteria.criteria${m+1}`),onChange:x=>{u.setFieldValue(`criteria.criteria${m+1}`,x)},w:"100%",style:{justifyContent:"space-between"}},u.key(`criteria.criteria${m+1}`))]},h.id))]})}),t.jsxs(I.Section,{inheritPadding:!0,py:"sm",children:[t.jsx(qe,{label:"Note",...u.getInputProps("comment"),readOnly:i,autosize:!0,minRows:4}),t.jsxs(f,{justify:"space-between",align:"center",mt:"sm",children:[t.jsxs(c,{children:["Total scores:"," ",t.jsx(c,{component:"span",fw:700,size:"xl",c:"blue",children:i?e==null?void 0:e.markResult:Object.values(u.values.criteria).reduce((h,m)=>m>0?h+m+4:h,0)})]}),i?t.jsxs(t.Fragment,{children:[t.jsx(O,{size:"md",variant:"outline",onClick:()=>r(!1),type:"button",disabled:e==null?void 0:e.disabled,children:"Edit"}),t.jsx(Qe,{children:t.jsx(O,{type:"submit",hidden:!0,disabled:e==null?void 0:e.disabled})})]}):t.jsx(O,{size:"md",type:"submit",loading:e==null?void 0:e.isLoading,disabled:e==null?void 0:e.disabled,children:"Submit"})]})]})]}),t.jsx(We,{opened:d,onClose:o,title:"Project Detail",centered:!0,transitionProps:{transition:"fade",duration:200},children:t.jsxs(f,{justify:"space-between",align:"start",gap:"sm",direction:"column",children:[t.jsxs(f,{direction:"column",children:[t.jsxs(f,{justify:"space-between",gap:"sm",children:[t.jsx(c,{fw:700,size:"md",w:60,children:"Name"}),t.jsx(c,{c:"orange.8",flex:1,children:e==null?void 0:e.title})]}),t.jsxs(f,{justify:"space-between",gap:"sm",children:[t.jsx(c,{fw:700,size:"md",w:60,children:"Project"}),t.jsx(c,{c:"orange.8",flex:1,children:e==null?void 0:e.project})]})]}),t.jsx(re,{size:"sm",flex:1,w:"100%"}),t.jsxs(f,{direction:"column",children:[t.jsx(c,{fw:700,children:"Description"}),t.jsx(c,{children:e==null?void 0:e.description})]})]})})]})},st=e=>t.jsx(ce,{style:{width:44,height:40,display:"flex",justifyContent:"center",alignItems:"center"},withBorder:!0,children:e+4}),at=e=>t.jsx(ce,{style:{width:44,height:40,display:"flex",justifyContent:"center",alignItems:"center"},withBorder:!0,bg:"blue",c:"white",children:e+4});b.object({criteria:b.object({criteria1:b.number(),criteria2:b.number(),criteria3:b.number(),criteria4:b.number(),criteria5:b.number(),criteria6:b.number(),criteria7:b.number(),criteria8:b.number()}),comment:b.string().optional()});const ct=(e,i)=>{var r;return Object.keys(e.criteriaMark).length?(r=Object.keys(e.criteriaMark))==null?void 0:r.reduce((d,l,o)=>(d.criteria[`criteria${o+1}`]=e.criteriaMark[l]-4,d),{criteria:{}}):i.reduce((d,l,o)=>(d.criteria[`criteria${o+1}`]=1,d),{criteria:{}})},gt=()=>{const{userId:e}=Xe(),{data:i,refetch:r,isSuccess:d}=Ke(e,{skip:!e,refetchOnMountOrArgChange:!0}),{data:l}=Ye({}),{round1Closed:o,description:u}=Ze(),[w,{isLoading:z,reset:h}]=He(),m=async(n,k)=>{await w({...n,judgeId:Number(e)}).unwrap(),S(x.map(a=>a.id===k?{...a,opened:!a.opened}:a)),se.open({centered:!0,size:"xs",title:"Marking Success",children:t.jsxs(t.Fragment,{children:[t.jsx(c,{c:"green",children:"Your marking is successfully updated!"}),t.jsx(O,{fullWidth:!0,onClick:()=>se.closeAll(),mt:"md",bg:"green",children:"Ok"})]})}),h(),r()},[x,S]=C.useState([]);return C.useEffect(()=>{d&&S((i==null?void 0:i.map(n=>({id:n.projectId,opened:!1})))||[])},[d]),t.jsxs(F,{gutter:"lg",py:"lg",children:[t.jsx(Q,{span:12,children:t.jsxs(I,{radius:"lg",children:[t.jsx(I.Section,{p:"lg",children:t.jsx(c,{size:"xl",fw:700,c:"blue",children:"Judging Principle"})}),t.jsx(I.Section,{px:"lg",pb:"lg",children:t.jsx(c,{c:"gray.8",children:u})})]})}),t.jsx(Q,{span:12,children:t.jsx(c,{fw:700,size:"lg",children:"Team List & Scores"})}),t.jsx(Q,{span:12,children:t.jsx(f,{gap:"lg",direction:"column",w:"100%",children:i==null?void 0:i.map(n=>{var k;return t.jsx(pe,{isMarked:n.markedBỵJudge,markResult:(n==null?void 0:n.totalMark)??0,title:`${n.groupName}`,opened:((k=x.find(a=>a.id===n.projectId))==null?void 0:k.opened)??!1,toggle:()=>{S(x.map(a=>a.id===n.projectId?{...a,opened:!a.opened}:a))},children:t.jsx(rt,{description:n.description??"",title:n.groupName,project:n.projectTitle,markResult:n.totalMark??0,isMarked:n.markedBỵJudge,onMark:a=>m(a,n.projectId),isLoading:z,id:n.projectId,criteria:ct(n,l??[]),criteriaList:l??[],comment:n==null?void 0:n.comment,disabled:o})},`${n.groupName}`)})})})]})};export{gt as default};
